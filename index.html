<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <title>Babylon.js sample code</title>

        <!-- Babylon.js -->
        <script src="https://code.jquery.com/pep/0.4.2/pep.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
        <script src="https://preview.babylonjs.com/ammo.js"></script>
        <script src="https://preview.babylonjs.com/cannon.js"></script>
        <script src="https://preview.babylonjs.com/Oimo.js"></script>
        <script src="https://preview.babylonjs.com/gltf_validator.js"></script>
        <script src="https://preview.babylonjs.com/earcut.min.js"></script>
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>
        <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
        <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
        <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>    
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
        <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
        <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
        
        <!-- Text to speech Dependency -->
        <script type="text/javascript" src="https://sdk.amazonaws.com/js/aws-sdk-2.923.0.min.js"></script>
    
        <!-- Host Build File -->
        <script type="text/javascript" src="../dist/host.babylon.js"></script>

        <style>
            html, body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #renderCanvas {
                width: 100%;
                height: 100%;
                touch-action: none;
            }
            
            #loadScreen {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 100%;
                height: 100%;
                background-image: url('assets/images/load_screen.png');
                background-color: gray;
                background-repeat: no-repeat;
                background-attachment: fixed;
                background-position: center;
                background-size: contain;
                z-index: 9999;
              }
              
            #loader {
              border: 16px solid #3498db38;
              border-radius: 50%;
              border-top: 16px solid #3498db;
              width: 120px;
              height: 120px;
              -webkit-animation: spin 2s linear infinite;
              animation: spin 2s linear infinite;
              position: fixed;
              top: 180px;
              display: none;
            }

            @-webkit-keyframes spin {
              0% {
                -webkit-transform: rotate(0deg);
              }
              100% {
                -webkit-transform: rotate(360deg);
              }
            }

            @keyframes spin {
              0% {
                transform: rotate(0deg);
              }
              100% {
                transform: rotate(360deg);
              }
            }
            
            #textToSpeech{
                margin-left: 330px;
                display: none;
                
            }
        </style>
    </head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script src="./babylonScene.js"></script>
    
    <!-- Text to speech Dependency -->
    <!--<script type="text/javascript" src="https://sdk.amazonaws.com/js/aws-sdk-2.923.0.min.js"></script>-->
    
    <!-- BabylonJS Dependencies -->
    <!--<script src="https://preview.babylonjs.com/babylon.js"></script>
   <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>-->
    
    <!-- Host Build File -->
    <!--<script type="text/javascript" src="../dist/host.babylon.js"></script>-->
    
    <!--<div id="loadScreen">
        <div id="loader"></div>
    </div>-->
    
    <!--Text to speech controls-->
    <div id="textToSynth">
      <input autofocus size="23" type="text" id="textEntry" value="It's very good to meet you."/>
      <button class="btn default" onClick="speakText()">Synthesize</button>
      <p id="result">Enter text above then click Synthesize</p>
    </div>
     <audio id="audioPlayback" controls>
      <source id="audioSource" type="audio/mp3" src="">
    </audio>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.410.0.min.js"></script>
    <script type="text/javascript">
        // Initialize the Amazon Cognito credentials provider
        AWS.config.region = 'us-east-1';
        AWS.config.credentials = new AWS.CognitoIdentityCredentials({IdentityPoolId: 'us-east-1:abf85ce5-6157-43df-97f9-471e86d2f9d5'});

        // Function invoked by button click
        function speakText() {
            // Create the JSON parameters for getSynthesizeSpeechUrl
            var speechParams = {
                OutputFormat: "mp3",
                SampleRate: "16000",
                Text: "",
                TextType: "text",
                VoiceId: "Joanna"
            };
            speechParams.Text = document.getElementById("textEntry").value;

            // Create the Polly service object and presigner object
            var polly = new AWS.Polly({apiVersion: '2016-06-10'});
            var signer = new AWS.Polly.Presigner(speechParams, polly)

            // Create presigned URL of synthesized speech file
            signer.getSynthesizeSpeechUrl(speechParams, function(error, url) {
            if (error) {
                document.getElementById('result').innerHTML = error;
            } else {
                document.getElementById('audioSource').src = url;
                document.getElementById('audioPlayback').load();
                document.getElementById('result').innerHTML = "Speech ready to play.";
            }
          });
        }
    </script>
    <!--<div id="textToSpeech">
        <button class="tab current" onclick="toggleHost(event)">Casi</button>
        <div>
            <textarea autofocus rows="4" cols="30" class="textEntry Casi">
                <speak>
                    <amazon:domain name="conversational">
                        Hello, my name is Casi. I used to only be a host inside Amazon Sumerian, but
                        now you can use me in other Javascript runtime environments like Babylon js. Right now,
                        <mark name='{"feature":"PointOfInterestFeature","method":"setTargetByName","args":["char:gaze"]}' />
                        my friend and I here are in Babylon js.
                  </amazon:domain>
                </speak>
            </textarea>
        </div>
        <div>
            <button id="play" class="speechButton">Play</button>
            <button id="pause" class="speechButton">Pause</button>
            <button id="resume" class="speechButton">Resume</button>
            <button id="stop" class="speechButton">Stop</button>
          </div>
          <div>
            <button id="gestures" class="gestureButton">Generate Gestures</button>
          </div>
          <div>
            <select id="emotes" class="gestureButton"></select>
          </div>
          <div>
            <button id="playEmote" class="gestureButton">Play Emote</button>
          </div>
    </div>-->
    
    <!--Create the BabylonJS Scene -->
    <script>
        //Initialize global variables
       // const speakers = new Map([
         //   ['Casi', undefined],
          //]);

          //main();
          
          //Initialize AWS and create Polly service objects
          /*-async function main(){
            window.AWS.config.region = 'us-east-1';
            window.AWS.config.credentials = new AWS.CognitoIdentityCredentials({
              IdentityPoolId: 'us-east-1:abf85ce5-6157-43df-97f9-471e86d2f9d5',
            });
            
            //Initializing the host TextToSpeechFeature
            const polly = new AWS.Polly();
            const presigner = new AWS.Polly.Presigner();
            const speechInit = HOST.aws.TextToSpeechFeature.initializeService(
              polly,
              presigner,
              window.AWS.VERSION
            );
            
            //Define the gltf assets that will represent the hosts
            const characterFile1 = 'C:\babylon\babylonJs_sample_server-master\public\amazon-sumerian-hosts\BabylonModel\project.blend1.gltf';
            const animationPath1 = './assets/glTF/animations/adult_female';
            const animationFiles = [
              'stand_idle.glb',
              'lipsync.glb',
              'gesture.glb',
              'emote.glb',
              'face_idle.glb',
              'blink.glb',
              'poi.glb',
            ];
            const gestureConfigFile = 'gesture.json';
            const poiConfigFile = 'poi.json';
            const audioAttachJoint1 = 'char:def_c_neckB'; // Name of the joint to attach audio to
            const audioAttachJoint2 = 'char:head';
            const lookJoint1 = 'char:jx_c_look'; // Name of the joint to use for point of interest target tracking
            const lookJoint2 = 'char:gaze';
            const voice1 = 'Joanna'; // Polly voice. Full list of available voices at: https://docs.aws.amazon.com/polly/latest/dg/voicelist.html
            const voiceEngine = 'neural'; // Neural engine is not available for all voices in all regions: https://docs.aws.amazon.com/polly/latest/dg/NTTS-main.html
            
            //Set up BabylonJS Scene and hosts
            const {scene, camera} = createScene();
            const {
                character: character1,
                clips: clips1,
                bindPoseOffset: bindPoseOffset1,
              } = await loadCharacter(
                scene,
                characterFile1,
                animationPath1,
                animationFiles
              );
              character1.position.x = 1.25;
              character1.rotation.y = -0.5;



          };*/
        
        </script>
</body>
</html>
